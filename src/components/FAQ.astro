---
// 1. Добавляем render в импорт
import { getCollection, render } from 'astro:content';

const allFaqs = await getCollection('faq');
const sortedFaqs = allFaqs.sort((a, b) => a.data.order - b.data.order);
---

<section id="faq" class="py-24 bg-base-100 reveal">
  <div class="max-w-[85rem] px-4 sm:px-6 lg:px-8 mx-auto">
    <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
      <h2 class="text-3xl font-heading font-black text-primary sm:text-4xl uppercase tracking-tight">
        Często Zadawane <span class="text-primary">Pytania</span>
      </h2>
    </div>

    <div class="max-w-3xl mx-auto">
      <div class="hs-accordion-group">
        
        {sortedFaqs.map(async (faq) => {
          // 2. ИСПРАВЛЕНИЕ: Используем функцию render(faq) вместо faq.render()
          const { Content } = await render(faq);
          
          return (
            <div class="hs-accordion bg-base-100 border border-transparent rounded-2xl p-6 mb-4 transition-all duration-300 hs-accordion-active:bg-base-100 hs-accordion-active:border-base-300" id={`hs-basic-heading-${faq.id}`}>
              <button class="hs-accordion-toggle group inline-flex items-center gap-x-3 w-full font-heading font-bold text-start text-base-content hover:text-primary focus:outline-none transition" 
                      aria-expanded="false"
                      aria-controls={`hs-basic-collapse-${faq.id}`}>
                <svg class="hs-accordion-active:hidden block size-5 text-base-content/70 group-hover:text-primary" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                <svg class="hs-accordion-active:block hidden size-5 text-primary" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14"/></svg>
                
                {faq.data.question}
              </button>
              
              <div id={`hs-basic-collapse-${faq.id}`} class="hs-accordion-content hidden w-full overflow-hidden transition-[height] duration-300" role="region" aria-labelledby={`hs-basic-heading-${faq.id}`}>
                <div class="text-base-content/70 mt-4 leading-relaxed font-sans">
                  <Content />
                </div>
              </div>
            </div>
          );
        })}

      </div>
    </div>
  </div>
</section>