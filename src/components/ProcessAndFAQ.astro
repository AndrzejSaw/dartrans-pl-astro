---
// src/components/ProcessAndFAQ.astro
// Unified section combining Roadmap (Process) and FAQ in 2-column layout
import { getCollection, render } from 'astro:content';

const allFaqs = await getCollection('faq');
const sortedFaqs = allFaqs.sort((a, b) => a.data.order - b.data.order);

const roadmapSteps = [
  {
    number: 1,
    title: 'Ankieta',
    description: 'Wypełnij krótki formularz na stronie w 2 minuty.',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>`,
    active: true
  },
  {
    number: 2,
    title: 'Rozmowa',
    description: 'Omówimy warunki, trasy i odpowiemy na Twoje pytania.',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>`,
    active: true
  },
  {
    number: 3,
    title: 'Weryfikacja',
    description: 'Szybkie sprawdzenie dokumentów i kwalifikacji.',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><polyline points="16 11 18 13 22 9"/></svg>`,
    active: false
  },
  {
    number: 4,
    title: 'W Trasę',
    description: 'Odbiór pojazdu, ekwipunku i wyjazd na trasę.',
    icon: `<svg xmlns="http://www.w3.org/2000/svg" class="w-7 h-7" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3z"/></svg>`,
    active: false
  }
];
---

<section id="process" class="py-24 md:py-32 bg-base-100 relative overflow-hidden reveal">
  <div class="absolute top-0 right-0 w-1/3 h-full bg-primary/5 blur-[120px] -z-10"></div>

  <div class="max-w-[85rem] mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section Header -->
    <div class="max-w-2xl mx-auto text-center mb-16 lg:mb-20">
      <h2 class="text-3xl font-heading font-extrabold text-base-content sm:text-4xl md:text-5xl tracking-tight">
        Jak Do Nas <span class="text-primary">Dołączyć?</span>
      </h2>
      <p class="mt-4 text-lg font-sans text-base-content/60 leading-relaxed">
        Proces rekrutacji i odpowiedzi na najczęściej zadawane pytania
      </p>
    </div>

    <!-- Two Column Layout -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 lg:gap-16 items-start">
      
      <!-- Left Column: Roadmap (Process Steps) -->
      <div class="space-y-6">
        <div class="mb-8">
          <h3 class="text-2xl font-heading font-bold text-base-content uppercase tracking-tight mb-2">
            Tylko 4 Kroki
          </h3>
          <p class="text-base-content/60 text-sm">
            Od ankiety do otrzymania kluczy — minimum czasu
          </p>
        </div>

        <div class="space-y-4">
          {roadmapSteps.map((step) => (
            <div class={`group relative bg-base-100 rounded-2xl p-6 border transition-all duration-300 shadow-sm hover:shadow-md ${step.active ? 'border-primary/30 hover:border-primary/50' : 'border-base-content/10 hover:border-base-content/20'}`}>
              <div class="flex items-start gap-5">
                <!-- Number Badge -->
                <div class={`shrink-0 w-12 h-12 rounded-xl flex items-center justify-center font-heading font-black text-lg transition-all duration-300 ${step.active ? 'bg-primary text-primary-content' : 'bg-base-200 text-base-content/50 group-hover:bg-primary group-hover:text-primary-content'}`}>
                  {step.number}
                </div>
                
                <!-- Content -->
                <div class="flex-1">
                  <h4 class={`text-xl font-heading font-bold mb-2 uppercase tracking-tight transition-colors ${step.active ? 'text-base-content' : 'text-base-content/50 group-hover:text-base-content/70'}`}>
                    {step.title}
                  </h4>
                  <p class={`text-sm leading-relaxed transition-colors ${step.active ? 'text-base-content/70' : 'text-base-content/50 group-hover:text-base-content/60'}`}>
                    {step.description}
                  </p>
                </div>

                <!-- Icon -->
                <div class={`shrink-0 transition-colors ${step.active ? 'text-primary' : 'text-base-content/30 group-hover:text-base-content/50'}`} set:html={step.icon} />
              </div>
            </div>
          ))}
        </div>

        <!-- CTA Button -->
        <div class="pt-6">
          <a href="#apply" 
             class="btn btn-primary btn-lg font-heading font-bold !text-primary-content rounded-full px-10 w-full shadow-xl shadow-primary/20 border-none transition-all hover:scale-[1.02] active:scale-95"
             data-gtm-event="cta_click"
             data-gtm-location="process">
            Rozpocznij Aplikację
          </a>
        </div>
      </div>

      <!-- Right Column: FAQ -->
      <div class="space-y-6">
        <div class="mb-8">
          <h3 class="text-2xl font-heading font-bold text-base-content uppercase tracking-tight mb-2">
            Najczęstsze Pytania
          </h3>
          <p class="text-base-content/60 text-sm">
            Odpowiedzi na pytania, które zadają nasi kandydaci
          </p>
        </div>

        <div class="space-y-3">
          {sortedFaqs.map(async (faq, index) => {
            const { Content } = await render(faq);
            
            return (
              <div class="collapse collapse-plus bg-base-100 border border-base-content/10 hover:border-base-content/20 rounded-xl transition-all duration-300 shadow-sm hover:shadow-md">
                <input type="radio" name="faq-accordion" id={`faq-${faq.id}`} checked={index === 0} />
                <div class="collapse-title text-base font-heading font-bold text-base-content pr-10">
                  {faq.data.question}
                </div>
                <div class="collapse-content">
                  <div class="text-base-content/70 text-sm leading-relaxed font-sans pt-2">
                    <Content />
                  </div>
                </div>
              </div>
            );
          })}
        </div>
      </div>

    </div>
  </div>
</section>
